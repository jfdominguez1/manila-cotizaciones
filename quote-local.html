<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cotizaciones Manila ‚Äî Nueva Cotizaci√≥n Local</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='85'>üêü</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:ital,wght@0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css?v=3">
</head>
<body>

<!-- TOP NAV -->
<nav class="topnav">
  <img src="img/logo-manila.png" alt="Manila" class="nav-logo">
  <span class="nav-title">Cotizaciones</span>
  <div class="nav-links">
    <a href="index.html">Dashboard</a>
    <div class="nav-dropdown">
      <button class="nav-dropdown-label">Export <span class="nav-dropdown-arrow">‚ñæ</span></button>
      <div class="nav-dropdown-menu">
        <a href="quote.html">Nueva Export</a>
        <a href="history.html">Historial Export</a>
      </div>
    </div>
    <div class="nav-dropdown has-active">
      <button class="nav-dropdown-label">Local <span class="nav-dropdown-arrow">‚ñæ</span></button>
      <div class="nav-dropdown-menu">
        <a href="quote-local.html" class="active">Nueva Local</a>
        <a href="history-local.html">Historial Local</a>
      </div>
    </div>
    <a href="admin.html">Admin</a>
  </div>
  <div class="nav-right">
    <span class="nav-version">v2.3.6</span>
    <span class="nav-user" id="nav-user"></span>
    <button class="btn-logout" id="btn-logout">Salir</button>
  </div>
</nav>

<!-- MAIN LAYOUT -->
<div class="quote-layout">

  <!-- PANEL IZQUIERDO -->
  <aside class="quote-panel">

    <div class="panel-header">
      <h2>Nueva Cotizaci√≥n Local</h2>
      <span class="quote-number" id="panel-quote-number">‚Äî</span>
    </div>

    <!-- Checklist de completitud -->
    <div class="panel-section checklist-section" id="checklist-section">
      <h3>Completitud</h3>
      <div class="checklist-panel" id="checklist-panel"></div>
    </div>

    <!-- Producto -->
    <div class="panel-section">
      <h3>Producto</h3>
      <div class="product-selector">
        <div class="product-thumb-placeholder" id="product-thumb-wrap"><span>üì¶</span></div>
        <div style="flex:1">
          <select id="product-select" style="width:100%;padding:7px 10px;border:1px solid var(--gray-200);border-radius:6px;font-size:13px;font-family:var(--font);outline:none;color:var(--carbon)">
            <option value="">‚Äî Seleccionar producto ‚Äî</option>
          </select>
        </div>
      </div>
      <div class="quote-photo-gallery" id="quote-photo-gallery" style="display:none"></div>
    </div>

    <!-- Marca -->
    <div class="panel-section">
      <h3>Marca</h3>
      <div class="brand-switcher" id="brand-switcher">
        <button class="brand-btn active" data-brand="manila">Manila<br>S.A.</button>
        <button class="brand-btn" data-brand="patagonia">Patagonia<br>Exquisiteces</button>
        <button class="brand-btn" data-brand="andes">Andes<br>Natural Fish</button>
      </div>
    </div>

    <!-- Tipo de cambio -->
    <div class="panel-section">
      <h3>Tipo de cambio</h3>
      <div class="form-row">
        <label id="usd-ars-rate-label">Cotizaci√≥n del d√≥lar (ARS/USD)</label>
        <input type="text" inputmode="decimal" id="usd-ars-rate" placeholder="Ej: 1450">
      </div>
    </div>

    <!-- Identificaci√≥n -->
    <div class="panel-section">
      <h3>Identificaci√≥n</h3>
      <div class="form-row">
        <label>Alias / sobrenombre</label>
        <input type="text" id="quote-alias" placeholder="Ej: Pedido Distribuidora Sur, Prueba CABA...">
      </div>
    </div>

    <!-- Cliente -->
    <div class="panel-section">
      <h3>Cliente</h3>
      <div class="form-row">
        <label>Nombre / Empresa</label>
        <input type="text" id="client-name" placeholder="Distribuidora XYZ...">
      </div>
      <div class="form-row-2col">
        <div>
          <label>Ciudad</label>
          <input type="text" id="client-city" placeholder="CABA, Neuqu√©n...">
        </div>
        <div>
          <label>Contacto</label>
          <input type="text" id="client-contact" placeholder="Juan P√©rez">
        </div>
      </div>
      <div class="form-row">
        <label>Direcci√≥n de entrega</label>
        <input type="text" id="client-address" placeholder="Calle, localidad...">
      </div>
    </div>

    <!-- Operaci√≥n -->
    <div class="panel-section">
      <h3>Operaci√≥n</h3>
      <div class="form-row">
        <label>Condici√≥n de entrega</label>
        <select id="delivery-term-select">
          <option value="">‚Äî Seleccionar ‚Äî</option>
        </select>
      </div>
      <div id="delivery-coverage"></div>
      <div class="form-row">
        <label>Tipo de transporte</label>
        <select id="transport-type">
          <option value="">‚Äî Seleccionar ‚Äî</option>
        </select>
      </div>
      <div class="form-row-2col">
        <div>
          <label>Volumen total (kg)</label>
          <input type="text" inputmode="decimal" id="volume-kg" placeholder="500">
        </div>
        <div>
          <label>N¬∞ de entregas</label>
          <input type="number" id="num-shipments" value="1" min="1" step="1">
        </div>
      </div>
      <div class="form-row">
        <label>Validez (d√≠as)</label>
        <input type="number" id="valid-days" value="15" min="1">
      </div>
      <div class="form-row">
        <label>Plazo de entrega</label>
        <input type="text" id="lead-time" placeholder="3-5 d√≠as h√°biles">
      </div>
    </div>

    <!-- Condiciones de pago -->
    <div class="panel-section">
      <h3>Condiciones de pago</h3>
      <div class="payment-terms-selector" id="payment-terms-selector"></div>
      <div class="form-row" id="custom-payment-wrap" style="display:none;margin-top:8px">
        <label>Condici√≥n personalizada</label>
        <input type="text" id="custom-payment" placeholder="Ej: 50% adelanto + 50% a 30 d√≠as">
      </div>
    </div>

    <!-- Propuesta -->
    <div class="panel-section">
      <h3>Propuesta al cliente</h3>
      <div class="form-row">
        <label>Comentarios / condiciones para el cliente</label>
        <textarea id="client-comments" placeholder="Condiciones especiales, packaging, notas..." style="min-height:72px"></textarea>
      </div>
      <div class="form-row">
        <label>Notas internas (no aparecen en PDF)</label>
        <textarea id="quote-notes" placeholder="Observaciones internas..."></textarea>
      </div>
    </div>

    <!-- Resumen de costos -->
    <div class="panel-section">
      <h3>Resumen de costos</h3>
      <div class="cost-summary" id="cost-summary"></div>
      <div class="margin-row">
        <label>Margen</label>
        <input type="text" inputmode="decimal" id="margin-pct" value="20">
        <span class="margin-hint">%</span>
      </div>
      <div class="lock-toggle">
        <button class="lock-btn active" data-lock="margin">Fijar margen</button>
        <button class="lock-btn" data-lock="price">Fijar precio</button>
      </div>
      <div class="margin-row target-price-row">
        <label>Precio objetivo</label>
        <input type="text" inputmode="decimal" id="target-price" placeholder="‚Äî">
        <span class="margin-hint">ARS/kg</span>
      </div>
      <div class="quote-warnings" id="quote-warnings"></div>
      <div class="price-highlight" id="price-highlight">
        <div class="price-label">Precio de venta</div>
        <div class="price-both">
          <span class="price-kg" id="price-kg">$ ‚Äî</span>
          <span class="price-lb" id="price-usd" style="display:none"></span>
        </div>
      </div>
    </div>

    <!-- Acciones -->
    <div class="panel-actions">
      <button class="btn-primary" id="btn-confirm" disabled>Confirmar cotizaci√≥n</button>
      <button class="btn-secondary" id="btn-save-draft">Guardar borrador</button>
      <div style="display:flex;gap:8px">
        <button class="btn-secondary" id="btn-print-client" disabled style="flex:1">PDF Cliente</button>
        <button class="btn-secondary" id="btn-print-internal" disabled style="flex:1">PDF Costos</button>
      </div>
    </div>

  </aside>

  <!-- COLUMNA DERECHA: CAPAS DE COSTO -->
  <main class="quote-layers" id="layers-container"></main>

</div>

<!-- ============================================================
     PDF: PRINT ONLY
     ============================================================ -->
<div class="pdf-container" id="pdf-container">

  <!-- P√ÅGINA 1: INTERNA (costos) -->
  <div class="pdf-page pdf-internal-page" id="pdf-internal-page">
    <div class="pdf-internal-title">
      <span>Detalle de costos ‚Äî <span id="pdf-int-quote-number"></span><span id="pdf-int-alias" class="pdf-int-alias"></span></span>
      <span class="int-sub">USO INTERNO MANILA S.A. ‚Äî CONFIDENCIAL</span>
    </div>
    <div class="pdf-int-logistics" id="pdf-int-logistics"></div>
    <table class="pdf-cost-table" id="pdf-cost-table">
      <thead>
        <tr>
          <th>Concepto</th>
          <th>Fuente</th>
          <th class="num">Valor</th>
          <th class="num">Fijo/ent.</th>
          <th class="num">Costo/kg</th>
        </tr>
      </thead>
      <tbody id="pdf-cost-tbody"></tbody>
    </table>
    <div class="pdf-cost-breakdown" id="pdf-cost-breakdown"></div>
    <div class="pdf-summary-box">
      <div class="sum-cell">
        <div class="sum-label">Costo total</div>
        <div class="sum-val" id="pdf-sum-cost"></div>
        <div class="sum-sub">ARS/kg</div>
      </div>
      <div class="sum-cell">
        <div class="sum-label">Margen aplicado</div>
        <div class="sum-val" id="pdf-sum-margin"></div>
        <div class="sum-sub">%</div>
      </div>
      <div class="sum-cell">
        <div class="sum-label">Precio final</div>
        <div class="sum-val" id="pdf-sum-price"></div>
        <div class="sum-sub" id="pdf-sum-price-usd"></div>
      </div>
    </div>
    <div class="pdf-rate-note" id="pdf-rate-note"></div>
    <div class="pdf-meta-footer" id="pdf-meta-footer"></div>
  </div>

  <!-- P√ÅGINA 2: CLIENTE (espa√±ol, ARS) -->
  <div class="pdf-page pdf-client-page" id="pdf-client-page">

    <div class="pdf-copy-label">COPIA ENVIADA AL CLIENTE</div>

    <!-- Header -->
    <div class="pdf-header">
      <img id="pdf-logo" src="img/logo-manila.png" alt="Manila" class="pdf-brand-logo">
    </div>

    <!-- Barra de datos -->
    <div class="pdf-quote-bar">
      <div class="pdf-quote-number" id="pdf-quote-number">‚Äî</div>
      <div class="pdf-quote-meta">
        <span id="pdf-date"></span>
        <span id="pdf-valid"></span>
      </div>
    </div>

    <!-- Foto del producto -->
    <div class="pdf-photo-wrap" id="pdf-photo-wrap">
      <img id="pdf-product-img" src="" alt="" class="pdf-product-photo">
    </div>

    <!-- Nombre + specs -->
    <div class="pdf-product-block">
      <div class="pdf-product-name" id="pdf-product-name"></div>
      <div class="pdf-product-spec" id="pdf-product-spec"></div>
      <div class="pdf-product-details" id="pdf-product-details" style="display:none"></div>
    </div>

    <!-- Info grid -->
    <div class="pdf-section-label">Datos del pedido</div>
    <div class="pdf-info-grid" id="pdf-info-grid">
      <div class="pdf-info-cell">
        <div class="cell-label">Cliente</div>
        <div class="cell-val" id="pdf-client-val"></div>
      </div>
      <div class="pdf-info-cell">
        <div class="cell-label">Ciudad</div>
        <div class="cell-val" id="pdf-city-val"></div>
      </div>
      <div class="pdf-info-cell">
        <div class="cell-label">Entrega</div>
        <div class="cell-val" id="pdf-delivery-val"></div>
      </div>
      <div class="pdf-info-cell">
        <div class="cell-label">Transporte</div>
        <div class="cell-val" id="pdf-transport-val"></div>
      </div>
      <div class="pdf-info-cell">
        <div class="cell-label">Volumen</div>
        <div class="cell-val" id="pdf-volume-val"></div>
      </div>
      <div class="pdf-info-cell">
        <div class="cell-label">Plazo</div>
        <div class="cell-val" id="pdf-leadtime-val"></div>
      </div>
      <div class="pdf-info-cell">
        <div class="cell-label">V√°lida hasta</div>
        <div class="cell-val" id="pdf-validuntil-val"></div>
      </div>
      <div class="pdf-info-cell">
        <div class="cell-label">Origen</div>
        <div class="cell-val">Manila S.A. ‚Äî Bariloche, Patagonia</div>
      </div>
    </div>

    <!-- Condiciones de pago (prominente) -->
    <div class="pdf-payment-block" id="pdf-payment-block">
      <div class="pdf-payment-label">Condiciones de pago</div>
      <div class="pdf-payment-value" id="pdf-payment-val">‚Äî</div>
    </div>

    <!-- Comentarios -->
    <div class="pdf-comments" id="pdf-comments" style="display:none">
      <div class="pdf-comments-label">Notas y condiciones</div>
      <div class="pdf-comments-text" id="pdf-comments-text"></div>
    </div>

    <!-- Precio: ARS/kg -->
    <div class="pdf-price-block local-price" id="pdf-price-block">
      <div class="pdf-incoterm-label" id="pdf-delivery-label"></div>
      <div class="pdf-prices-row">
        <div class="pdf-price-unit">
          <span class="pdf-price-val" id="pdf-price-main">‚Äî</span>
          <span class="pdf-price-unit-label">ARS / kg</span>
        </div>
      </div>
      <div class="pdf-iva-notice">Precios no incluyen IVA</div>
    </div>

    <!-- Footer -->
    <div class="pdf-footer" id="pdf-footer">
      <span>Manila S.A. ‚Äî Bariloche, R√≠o Negro, Patagonia Argentina</span>
      <span>info@manilapatagonia.com ¬∑ www.manilapatagonia.com</span>
    </div>
  </div>

</div>

<script type="module" src="js/quote-local.js?v=5"></script>
</body>
</html>
