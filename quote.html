<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cotizaciones Manila ‚Äî Nueva Cotizaci√≥n</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='85'>üêü</text></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:ital,wght@0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css?v=8">
</head>
<body>

<!-- TOP NAV -->
<nav class="topnav">
  <img src="img/logo-manila.png" alt="Manila" class="nav-logo">
  <span class="nav-title">Cotizaciones</span>
  <div class="nav-links">
    <a href="index.html">Dashboard</a>
    <div class="nav-dropdown has-active">
      <button class="nav-dropdown-label">Export <span class="nav-dropdown-arrow">‚ñæ</span></button>
      <div class="nav-dropdown-menu">
        <a href="quote.html" class="active">Nueva Export</a>
        <a href="history.html">Historial Export</a>
      </div>
    </div>
    <div class="nav-dropdown">
      <button class="nav-dropdown-label">Local <span class="nav-dropdown-arrow">‚ñæ</span></button>
      <div class="nav-dropdown-menu">
        <a href="quote-local.html">Nueva Local</a>
        <a href="history-local.html">Historial Local</a>
      </div>
    </div>
    <a href="admin.html">Admin</a>
  </div>
  <div class="nav-right">
    <span class="nav-version">v2.5.0</span>
    <span class="nav-user" id="nav-user"></span>
    <button class="btn-logout" id="btn-logout">Salir</button>
  </div>
</nav>

<!-- MAIN LAYOUT -->
<div class="quote-layout">

  <!-- PANEL IZQUIERDO -->
  <aside class="quote-panel">

    <div class="panel-header">
      <h2>Nueva Cotizaci√≥n</h2>
      <span class="quote-number" id="panel-quote-number">‚Äî</span>
    </div>

    <!-- Checklist de completitud -->
    <div class="panel-section checklist-section" id="checklist-section">
      <h3>Completitud</h3>
      <div class="checklist-panel" id="checklist-panel"></div>
    </div>

    <!-- Producto -->
    <div class="panel-section">
      <h3>Producto</h3>
      <div class="product-selector">
        <div class="product-thumb-placeholder" id="product-thumb-wrap"><span>üì¶</span></div>
        <div style="flex:1">
          <select id="product-select" style="width:100%;padding:7px 10px;border:1px solid var(--gray-200);border-radius:6px;font-size:13px;font-family:var(--font);outline:none;color:var(--carbon)">
            <option value="">‚Äî Seleccionar producto ‚Äî</option>
          </select>
        </div>
      </div>
      <div class="quote-photo-gallery" id="quote-photo-gallery" style="display:none"></div>
    </div>

    <!-- Marca -->
    <div class="panel-section">
      <h3>Marca</h3>
      <div class="brand-switcher" id="brand-switcher">
        <button class="brand-btn" data-brand="manila">Manila<br>S.A.</button>
        <button class="brand-btn active" data-brand="patagonia">Patagonia<br>Exquisiteces</button>
        <button class="brand-btn" data-brand="andes">Andes<br>Natural Fish</button>
      </div>
    </div>

    <!-- Cotizaci√≥n del d√≥lar -->
    <div class="panel-section">
      <h3>Tipo de cambio</h3>
      <div class="form-row">
        <label id="usd-ars-rate-label">Cotizaci√≥n del d√≥lar (ARS/USD)</label>
        <input type="text" inputmode="decimal" id="usd-ars-rate" placeholder="Ej: 1450">
      </div>
    </div>

    <!-- Identificaci√≥n propuesta -->
    <div class="panel-section">
      <h3>Identificaci√≥n propuesta</h3>
      <div class="form-row">
        <label>Alias / sobrenombre <span style="font-weight:400;color:var(--gray-500)">(visible en costos e historial)</span></label>
        <input type="text" id="quote-alias" placeholder="Ej: Fresco USA Q1, Prueba Miami...">
      </div>
    </div>

    <!-- Cliente -->
    <div class="panel-section">
      <h3>Cliente</h3>
      <div class="form-row">
        <label>Nombre / Empresa</label>
        <input type="text" id="client-name" placeholder="Distribuidor XYZ...">
      </div>
      <div class="form-row-2col">
        <div>
          <label>Pa√≠s destino</label>
          <input type="text" id="client-country" placeholder="USA">
        </div>
        <div>
          <label>Contacto</label>
          <input type="text" id="client-contact" placeholder="John Smith">
        </div>
      </div>
      <div class="form-row">
        <label>Ciudad / Puerto de destino</label>
        <input type="text" id="client-dest-port" placeholder="Miami, FL ‚Äî USA">
      </div>
    </div>

    <!-- Operaci√≥n -->
    <div class="panel-section">
      <h3>Operaci√≥n</h3>
      <div class="form-row">
        <label>Incoterm</label>
        <select id="incoterm-select"></select>
      </div>
      <div id="incoterm-coverage"></div>
      <div class="form-row">
        <label>Puerto / Ciudad de origen</label>
        <input type="text" id="origin-port" placeholder="Buenos Aires, Argentina">
      </div>
      <div class="form-row">
        <label>Tipo de env√≠o</label>
        <select id="transport-type">
          <option value="">‚Äî Seleccionar ‚Äî</option>
          <option value="Mar√≠timo">Mar√≠timo</option>
          <option value="A√©reo">A√©reo</option>
          <option value="Terrestre">Terrestre</option>
          <option value="Mar√≠timo Refrigerado">Mar√≠timo Refrigerado</option>
          <option value="A√©reo Refrigerado">A√©reo Refrigerado</option>
        </select>
      </div>
      <div class="form-row-2col">
        <div>
          <label>Volumen total (kg)</label>
          <input type="text" inputmode="decimal" id="volume-kg" placeholder="10000">
        </div>
        <div>
          <label>N¬∞ de embarques</label>
          <input type="number" id="num-shipments" value="1" min="1" step="1">
        </div>
      </div>
      <div class="form-row">
        <label>Validez (d√≠as)</label>
        <input type="number" id="valid-days" value="15" min="1">
      </div>
      <div class="form-row">
        <label>Lead time</label>
        <input type="text" id="lead-time" placeholder="7-10 d√≠as desde confirmaci√≥n">
      </div>
    </div>

    <!-- Propuesta PDF -->
    <div class="panel-section">
      <h3>Propuesta al cliente</h3>
      <div class="form-row" id="cert-picker-wrap" style="display:none">
        <label>Certificaciones a mostrar</label>
        <div class="cert-checkboxes" id="cert-picker"></div>
      </div>
      <div class="form-row">
        <label>Comentarios / condiciones para el cliente</label>
        <textarea id="client-comments" placeholder="Condiciones de pago, packaging especial, notas de la oferta..." style="min-height:72px"></textarea>
      </div>
      <div class="form-row">
        <label>Notas internas (no aparecen en PDF)</label>
        <textarea id="quote-notes" placeholder="Observaciones internas, contexto de la negociaci√≥n..."></textarea>
      </div>
    </div>

    <!-- Resumen de costos -->
    <div class="panel-section">
      <h3>Resumen de costos</h3>
      <div class="cost-summary" id="cost-summary"></div>
      <div class="margin-row">
        <label>Margen</label>
        <input type="text" inputmode="decimal" id="margin-pct" value="20">
        <span class="margin-hint">%</span>
      </div>
      <div class="lock-toggle">
        <button class="lock-btn active" data-lock="margin">Fijar margen</button>
        <button class="lock-btn" data-lock="price">Fijar precio</button>
      </div>
      <div class="margin-row target-price-row">
        <label>Precio objetivo</label>
        <input type="text" inputmode="decimal" id="target-price" placeholder="‚Äî">
        <span class="margin-hint">USD/kg</span>
      </div>
      <div class="quote-warnings" id="quote-warnings"></div>
      <div class="price-highlight" id="price-highlight">
        <div class="price-label">Precio de venta</div>
        <div class="price-both">
          <span class="price-kg" id="price-kg">USD ‚Äî</span>
          <span class="price-sep">¬∑</span>
          <span class="price-lb" id="price-lb">‚Äî /lb</span>
        </div>
      </div>
    </div>

    <!-- Acciones -->
    <div class="panel-actions">
      <button class="btn-primary" id="btn-confirm" disabled>Confirmar cotizaci√≥n</button>
      <button class="btn-secondary" id="btn-save-draft">Guardar borrador</button>
      <div style="display:flex;gap:8px">
        <button class="btn-secondary" id="btn-print-client" disabled style="flex:1">PDF Cliente</button>
        <button class="btn-secondary" id="btn-print-internal" disabled style="flex:1">PDF Costos</button>
      </div>
    </div>

  </aside>

  <!-- COLUMNA DERECHA: CAPAS DE COSTO -->
  <main class="quote-layers" id="layers-container"></main>

</div>

<!-- ============================================================
     PDF: PRINT ONLY
     ============================================================ -->
<div class="pdf-container" id="pdf-container">

  <!-- P√ÅGINA 1: INTERNA (costos) ‚Äî imprime primero en PDF Costos -->
  <div class="pdf-page pdf-internal-page" id="pdf-internal-page">
    <!-- Header compacto -->
    <div class="pdi-header">
      <div class="pdi-header-left">
        <span class="pdi-title">Detalle de Costos</span>
        <span class="pdi-quote-num" id="pdf-int-quote-number"></span>
        <span class="pdi-alias" id="pdf-int-alias"></span>
      </div>
      <div class="pdi-header-right">
        <span class="pdi-confidential">CONFIDENCIAL</span>
        <span class="pdi-date" id="pdi-date"></span>
      </div>
    </div>

    <!-- Logistics strip -->
    <div class="pdi-logistics" id="pdf-int-logistics"></div>

    <!-- Tabla de costos (4 columnas) -->
    <table class="pdi-table" id="pdf-cost-table">
      <thead>
        <tr>
          <th>Concepto</th>
          <th class="num">Detalle</th>
          <th class="num">Fijo/emb.</th>
          <th class="num">USD/kg</th>
        </tr>
      </thead>
      <tbody id="pdf-cost-tbody"></tbody>
    </table>

    <!-- Summary strip horizontal -->
    <div class="pdi-summary" id="pdi-summary">
      <div class="pdi-sum-cell">
        <span class="pdi-sum-label">Costo</span>
        <span class="pdi-sum-val" id="pdf-sum-cost"></span>
        <span class="pdi-sum-sub" id="pdf-sum-cost-lb"></span>
      </div>
      <div class="pdi-sum-cell">
        <span class="pdi-sum-label">Comisi√≥n</span>
        <span class="pdi-sum-val" id="pdf-sum-comm"></span>
        <span class="pdi-sum-sub">&nbsp;</span>
      </div>
      <div class="pdi-sum-cell">
        <span class="pdi-sum-label">Margen</span>
        <span class="pdi-sum-val" id="pdf-sum-margin"></span>
        <span class="pdi-sum-sub" id="pdf-sum-margin-abs"></span>
      </div>
      <div class="pdi-sum-cell pdi-sum-highlight">
        <span class="pdi-sum-label">Precio</span>
        <span class="pdi-sum-val" id="pdf-sum-price"></span>
        <span class="pdi-sum-sub"><span id="pdf-sum-price-lb"></span> ¬∑ <span id="pdf-sum-price-total"></span></span>
      </div>
    </div>

    <div class="pdi-rate-note" id="pdf-rate-note"></div>
    <div class="pdi-footer" id="pdf-meta-footer"></div>
  </div>

  <!-- P√ÅGINA 2: CLIENTE ‚Äî sola en PDF Cliente, segunda en PDF Costos -->
  <div class="pdf-page pdf-client-page" id="pdf-client-page">

    <!-- Inscripci√≥n visible solo en PDF Costos (modo internal) -->
    <div class="pdf-copy-label">COPIA ENVIADA AL CLIENTE</div>

    <!-- Header: logos sobre la l√≠nea -->
    <div class="pdf-header">
      <img id="pdf-logo" src="img/logo-manila.png" alt="Manila" class="pdf-brand-logo">
      <img id="pdf-manila-logo-small" src="img/logo-manila.png" alt="Manila S.A." class="pdf-manila-small">
    </div>

    <!-- Barra de datos debajo de la l√≠nea -->
    <div class="pdf-quote-bar">
      <div class="pdf-quote-number" id="pdf-quote-number">‚Äî</div>
      <div class="pdf-quote-meta">
        <span id="pdf-date"></span>
        <span id="pdf-valid"></span>
      </div>
    </div>

    <!-- Foto del producto (siempre visible, fallback de color) -->
    <div class="pdf-photo-wrap" id="pdf-photo-wrap">
      <img id="pdf-product-img" src="" alt="" class="pdf-product-photo">
    </div>

    <!-- Nombre + specs del producto -->
    <div class="pdf-product-block">
      <div class="pdf-product-name" id="pdf-product-name"></div>
      <div class="pdf-product-spec" id="pdf-product-spec"></div>
      <div class="pdf-product-details" id="pdf-product-details" style="display:none"></div>
    </div>

    <!-- Info grid: todos los datos del env√≠o -->
    <div class="pdf-section-label">Shipment Details</div>
    <div class="pdf-info-grid" id="pdf-info-grid">
      <div class="pdf-info-cell">
        <div class="cell-label">To</div>
        <div class="cell-val" id="pdf-client-val"></div>
      </div>
      <div class="pdf-info-cell">
        <div class="cell-label">Destination</div>
        <div class="cell-val" id="pdf-dest-val"></div>
      </div>
      <div class="pdf-info-cell">
        <div class="cell-label">From</div>
        <div class="cell-val">Manila S.A. ‚Äî Bariloche, Argentina</div>
      </div>
      <div class="pdf-info-cell">
        <div class="cell-label" id="pdf-origin-label">Port of Origin</div>
        <div class="cell-val" id="pdf-origin-val"></div>
      </div>
      <div class="pdf-info-cell">
        <div class="cell-label">Transport</div>
        <div class="cell-val" id="pdf-transport-val"></div>
      </div>
      <div class="pdf-info-cell">
        <div class="cell-label">Volume</div>
        <div class="cell-val" id="pdf-volume-val"></div>
      </div>
      <div class="pdf-info-cell">
        <div class="cell-label">Lead Time</div>
        <div class="cell-val" id="pdf-leadtime-val"></div>
      </div>
      <div class="pdf-info-cell">
        <div class="cell-label">Valid Until</div>
        <div class="cell-val" id="pdf-validuntil-val"></div>
      </div>
    </div>

    <!-- Certificaciones (solo las seleccionadas) -->
    <div class="pdf-certs" id="pdf-certs"></div>

    <!-- Comentarios para el cliente -->
    <div class="pdf-comments" id="pdf-comments" style="display:none">
      <div class="pdf-comments-label">Notes & Conditions</div>
      <div class="pdf-comments-text" id="pdf-comments-text"></div>
    </div>

    <!-- Incoterm banner ‚Äî grande y expl√≠cito -->
    <div class="pdf-incoterm-banner" id="pdf-incoterm-banner">
      <div class="pdf-incoterm-id" id="pdf-incoterm-id">FOB</div>
      <div class="pdf-incoterm-info">
        <div class="pdf-incoterm-fullname" id="pdf-incoterm-fullname">Free On Board</div>
        <div class="pdf-incoterm-desc" id="pdf-incoterm-desc"></div>
        <div class="pdf-incoterm-origin" id="pdf-incoterm-origin"></div>
      </div>
    </div>

    <!-- Precio: kg y lb al mismo nivel -->
    <div class="pdf-price-block" id="pdf-price-block">
      <div class="pdf-prices-row">
        <div class="pdf-price-unit">
          <span class="pdf-price-val" id="pdf-price-main">‚Äî</span>
          <span class="pdf-price-unit-label">USD / kg</span>
        </div>
        <div class="pdf-price-divider">|</div>
        <div class="pdf-price-unit">
          <span class="pdf-price-val" id="pdf-price-lb-val">‚Äî</span>
          <span class="pdf-price-unit-label">USD / lb</span>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="pdf-footer">
      <span>Manila S.A. ‚Äî Bariloche, R√≠o Negro, Patagonia Argentina</span>
      <span>info@manilapatagonia.com ¬∑ www.manilapatagonia.com</span>
    </div>
  </div>

</div>

<script type="module" src="js/quote.js?v=35"></script>
</body>
</html>
